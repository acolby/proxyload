# Barrel Utility

The barrel utility is responsible for enhancing interface files with variation types and creating barrel export files throughout the code. Remember, these are only for convenience, at runtime a Proxy is what is actually consumed, so things are actually pulled in dynamically via loaders under the hood.

## Overview

The barrel utility automatically enhances TypeScript interface files and generates barrel export files for your proxied code structure. It scans your proxied directory and:

1. **Enhances interface files** (`interface.ts`) - Adds variation types and component types
2. **Creates barrel files** (`index.ts`) - Export aggregators for each type category
3. **Creates top-level barrel** (`index.ts`) - Master export file for all types

## Usage

```typescript
import barrel from "@acolby/proxyload/barrel";

await barrel({
  dir: "./proxied", // Path to your proxied directory
  exclude: ["node_modules"], // Directories to exclude from processing
});
```

## Generated Files

### 1. Enhanced Interface Files (`[TYPE]/[NAME]/interface.ts`)

Enhances existing interface files with variation types and component types:

```typescript
// Original: proxied/Component/Button/interface.ts
import type React from "react";

export type Params = {
  text: string;
  onClick: () => void;
};

export type Returns = React.JSX.Element;

// Enhanced by barrel utility:
// Generated by proxyload
export type Variations = "default" | "secondary";

export type Interface = (
  props: Params & { variation?: Variations; version?: string }
) => Returns;
```

### 2. Barrel Files (`[TYPE]/index.ts`)

Creates export aggregators for each type category:

```typescript
// Generated: proxied/Component/index.ts
export { default as Button } from "./Button/default";
export { default as EmailForm } from "./EmailForm/default";
```

### 3. Top-Level Barrel (`index.ts`)

Master export file that barrels all types:

```typescript
// Generated: proxied/index.ts
export * as Component from "./Component";
export * as Loader from "./Loader";
```

## Directory Structure

The utility expects and generates files for this structure:

```
/proxied
  /[TYPE]                    # e.g., Component, Loader, Util
    /[NAME]                  # e.g., Button, EmailForm
      interface.ts           # Manual: Defines Params, Returns (enhanced by barrel)
      /[VARIATION]           # e.g., default, secondary
        index.ts(x)          # Manual: Implementation
    index.ts                 # Generated: Type barrel
  index.ts                   # Generated: Top-level barrel
```

## Integration with Build Process

Typically used in build scripts or development workflows:

```json
// package.json
{
  "scripts": {
    "barrel": "tsx ./scripts/barrel.ts",
    "build": "npm run barrel && npm run build:components"
  }
}
```

```typescript
// scripts/barrel.ts
import barrel from "@acolby/proxyload/barrel";

barrel({
  dir: `${__dirname}/../proxied`,
  exclude: ["node_modules", ".git"],
});
```

## Benefits

- **Type Safety**: Enhanced interface files ensure compile-time safety
- **Variation Support**: Built-in variation type definitions
- **Auto-discovery**: Tools can automatically find and load components
- **Consistency**: Enforces the Proxyload directory convention
- **Developer Experience**: Reduces boilerplate and manual file creation
- **Clean Architecture**: Separates interface enhancement from type generation

## Notes

- Enhanced interface files are marked with `// Generated by proxyload`
- Always run barrel after adding new components or variations
- The utility respects the `exclude` parameter to skip unwanted directories
- Enhanced interface files should not be manually edited as they will be overwritten
- The barrel utility works in conjunction with the typegen utility for complete type system support
